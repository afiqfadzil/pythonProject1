<WindowManager>:
    TitleWindow:
    MainWindow:
    AddressScreen:
    TestWindow:

    LoadingWindow:

    MaintenanceWindow:

    ExplanationWindow:

    ConnectionWindow:
    ResultWindow:

<MDTopAppBar>:
    title: "Locomotion Age Measurement"
    anchor_title: "center"
    size_hint: (1, 0.1)
    elevation: 10
    pos_hint : {"center_x" : 0.5 , "center_y" : 0.975}
<MDNavigationDrawer>:
    BoxLayout:
        orientation: 'horizontal'

<Overlay>:
    canvas:
        Color:
            rgba: 0, 0, 0, 0.5  # Adjust the alpha value (0.5 in this case) to control dim intensity
        Rectangle:
            pos: self.pos
            size:self.size

<MDLabel> :
    color: 1, 1, 1, 1
    font_name: "meiryo.ttc"
    font_size : '16sp'

<Label>:
    font_name: "meiryo.ttc"
    color: 1, 1, 1, 1
    font_name: "meiryo.ttc"
    font_size : '16sp'







<MDTextField> :

    multiline : False
    size_hint_x : 0.3
    font_size :'20sp'
    font_name: "meiryo.ttc"
    font_name_helper_text : "meiryo.ttc"
    helper_text_mode : "on_focus"


<canvas.before>
    Color:
        rgba:(29/255,62/255,89/255,1)
    Rectangle:
        pos : self.pos
        size : self.size





<TextInput>:
    font_size : '20sp'



<MDRectangleFlatButton>:
    size_hint : 0.1,0.035
    ripple_behaviour :True
    md_bg_color : 1,1,1,1



<AddressScreen>

    name : "address"
    FloatLayout:
        MDTextField :
            id : ip
            text:"192.168.5.1"
            hint_text:"IP アドレス"
            multiline : False
            size_hint_x : 0.3
            helper_text :"e.g : 127.0.0.1"
            icon_left: 'key-variant'
            normal_color: app.theme_cls.accent_color
            color_active: 211/255, 211/255, 211/255, 1

            max_height : dp(100)

            pos_hint : {"x":0.45,"y":0.75}
        MDLabel :
            text : "IPアドレス:"
            pos_hint : {"center_x":0.75,"center_y":0.785}

        MDRectangleFlatButton:
            pos_hint : {"x":0.45,"y":0.3}
            text : "Start"
            on_release :
                root.connect()

    Overlay:
        id: dim_overlay
        opacity: 1 if root.ids.nav_drawer.state == "open" else 0
        on_touch_down: root.ids.nav_drawer.set_state("closed")

    MDTopAppBar:
        left_action_items: [['menu', lambda x: nav_drawer.set_state("open")]]
    MDNavigationDrawer:
        id: nav_drawer
        BoxLayout:
            orientation: 'horizontal'



<MainWindow>:

    name : "main"



    FloatLayout:


        MDLabel :

            text : "年齢 :"
            pos_hint : {"center_x":0.85,"center_y":0.785}


        MDTextField :
            id : age
            text: "123"
            multiline : False
            hint_text:"必須"
            helper_text: "13~150"


            pos_hint : {"x":0.45,"y":0.75}

        MDLabel :
            text : "身長:"
            pos_hint : {"center_x":0.85,"center_y":0.685}



        MDTextField :
            id : ht
            multiline : False
            pos_hint : {"x":0.45,"y":0.65}
            hint_text:"必須"
            helper_text : "Max 2.50m"
            text:"123"
        MDLabel:
            text:"性別:"
            pos_hint : {"center_x":0.85,"center_y":0.565}
        MDLabel:
            text:"男性"
            pos_hint : {"center_x":0.95,"center_y":0.565}
        CheckBox:
            id: male_gender
            group: "gender"
            active: False
            pos_hint: {"x":0.45,"y":0.55}
            size_hint : 0.15,0.035
        MDLabel:
            text:"女性"
            pos_hint : {"center_x":1.1,"center_y":0.565}
        CheckBox:
            id: female_gender
            group: "gender"
            active: False
            pos_hint: {"x":0.60,"y":0.55}
            size_hint : 0.15,0.035
        MDLabel:
            text:"他の"
            pos_hint : {"center_x":1.25,"center_y":0.565}
        CheckBox:
            id: other_gender
            group: "gender"
            active: False
            pos_hint: {"x":0.75,"y":0.55}
            size_hint : 0.15,0.035






        MDLabel :
            id : error_label_main
            text : ""
            pos_hint : {"x":0.25,"y":0.2}
        MDRectangleFlatButton :
            pos_hint : {"x":0.45,"y":0.3}
            text : "Start"
            on_release :
                root.data_call()



    MDTopAppBar:

        left_action_items: [['arrow-left', lambda x: root.back()]]

    Overlay:
        id: dim_overlay
        opacity: 1 if root.ids.nav_drawer.state == "open" else 0
        on_touch_down: root.ids.nav_drawer.set_state("closed")
    MDNavigationDrawer:
        id: nav_drawer
        BoxLayout:
            orientation: 'horizontal'



<TestWindow>:

    name : "test"



    MDLabel :
        id : test2_label
        pos_hint : {"center_x" : 0.5 , "center_y" : 0.40}
        halign: "center"
        size_hint_x :1
        text :"Under Construction"

    Image :
        id : test_image
        source : 'assets/two_leg.png'
        pos_hint :{"center_x" : 0.5, "center_y" : 0.6 }
    MDRectangleFlatButton:
        text : "成功"
        pos_hint : {"center_x" : 0.25 , "center_y" : 0.25}
        on_release :
            root.passed()
            root.rating_func()
            root.next_screen_loading()
            root.next_screen_result()




    MDRectangleFlatButton :
        text : "失敗"
        pos_hint : {"center_x" : 0.5 , "center_y" : 0.25}
        on_release :
            root.failed()
            root.rating_func()
            root.next_screen_loading()
            root.next_screen_result()


    MDRectangleFlatButton :
        text : "やり直し"
        pos_hint : {"center_x" : 0.75 , "center_y" : 0.25}
        on_release:
            root.retry()
    Overlay:
        id: dim_overlay
        opacity: 1 if root.ids.nav_drawer.state == "open" else 0
        on_touch_down: root.ids.nav_drawer.set_state("closed")

    MDTopAppBar:
        left_action_items: [['menu', lambda x: nav_drawer.set_state("open")]]
    MDNavigationDrawer:
        id: nav_drawer
        BoxLayout:
            orientation: 'horizontal'








<ResultWindow>:

    name : "result"
    MDLabel :
        id:result_label_comment
        text : "You Old"
        halign: "center"
        size_hint_x :1
        pos_hint : {"center_x" : 0.5 , "center_y" : 0.5}

    MDLabel :
        id:result_label_age
        text : "You Old"
        halign: "center"
        size_hint_x :1
        pos_hint : {"center_x" : 0.5 , "center_y" : 0.45}
    MDLabel :
        id:result_label_rage
        halign: "center"
        size_hint_x :1
        text : "You Old"
        pos_hint : {"center_x" : 0.5 , "center_y" : 0.40}


    MDRectangleFlatButton :
        text : "End"
        pos_hint : {"center_x" : 0.5 , "center_y" : 0.25}
        on_release :
            app.root.current = "main"
            root.manager.transition.direction = "up"
    Overlay:
        id: dim_overlay
        opacity: 1 if root.ids.nav_drawer.state == "open" else 0
        on_touch_down: root.ids.nav_drawer.set_state("closed")

    MDTopAppBar:
        left_action_items: [['menu', lambda x: nav_drawer.set_state("open")]]
    MDNavigationDrawer:
        id: nav_drawer
        BoxLayout:
            orientation: 'horizontal'


<TitleWindow>:

    name : "title"

    MDLabel :
        id:title_label
        text : "ロコモ年齢自動測定システムの利用について"
        font_size : '25sp'
        size_hint_x : 1
        halign : "center"
        underline : True
        pos_hint : {"center_x" : 0.5 , "center_y" : 0.9}


    MDLabel :
        text : "       測定結果とコメントについてこのロコモ年齢測定システム\nは立ち上がり能力からあなたの基礎移動能力の現状と年齢\nに伴う衰退の傾向の予測を行います.測定結果には個人によって\n誤差があり，その評価やコメントは今後の基礎能力維持のための\n参考としてご認識いただけますようお願いします．\n     測定中の事故について本測定システムは安全性の面において，\nできる限りの工夫を行い，市販の電動症候椅子の安全基準を持して\nおりますが，被測者の基礎運動機能の低下や無理な立上がり等による\n転倒の恐れがあります．万が一，転倒による怪我が生じた場合，研究\n開発側は一切の責任を負いかねますのであらかじめご了承ください."
        pos_hint : {"center_x" : 0.6, "center_y" : 0.6}
        size_hint_x : 1




    MDRectangleFlatButton :
        text : "承知しました"
        pos_hint : {"center_x" : 0.5 , "center_y" : 0.25}
        size_hint : 0.3,0.05
        ripple_behaviour :True
        on_release :
            app.root.current = "main"
            root.manager.transition.direction = "left"





    MDTopAppBar:

        left_action_items: [['cog', lambda x: root.start_maintenance()]]
        right_action_items: [['information', lambda x: root.info()]]

    Overlay:
        id: dim_overlay
        opacity: 1 if root.ids.nav_drawer.state == "open" else 0
        on_touch_down: root.ids.nav_drawer.set_state("closed")
    MDNavigationDrawer:
        id: nav_drawer
        BoxLayout:
            orientation: 'horizontal'
<LoadingWindow>:
    name : "loading"
    on_enter:
        root.loading()



    MDFloatLayout:
        md_bg_color : 0,0,0,0
        MDGridLayout:
            id :loading
            angle : 0
            rows:2
            cols:2
            size_hint: None,None
            height:100
            width:100
            pos_hint:{"center_x":.5,"center_y":.6}
            spacing:5
            canvas.before:
                PushMatrix
                Rotate:
                    angle : self.angle
                    axis:0,0,1
                    origin: self.center
            canvas.after:
                PopMatrix
            MDFloatLayout:
                md_bg_color:rgba(242,80,34,255)
            MDFloatLayout:
                md_bg_color:rgba(242,80,34,255)
            MDFloatLayout:
                md_bg_color:rgba(242,80,34,255)
            MDFloatLayout:
                md_bg_color:rgba(242,80,34,255)




    MDLabel :
        id:loading_label
        text : "お待ちしてください。。。"
        pos_hint : {"center_x" : 0.5 , "center_y" : 0.4}
        halign :"center"
        size_hint_x :1



    MDRectangleFlatButton :
        id : load_button
        text : "Proceed"
        pos_hint : {"center_x" : 0.5 , "center_y" : 0.25}
        disabled : True
        on_release :
            root.disable_load_button()
            app.root.current = "test"
            root.manager.transition.direction = "up"


<ConnectionWindow>

    name : "connect"
    MDLabel :
        id:connect_label
        text : "サーバーとの接続が切断されています.接続状況を確認してください"
        pos_hint : {"center_x" : 0.5 , "center_y" : 0.5}
        halign : "center"
        size_hint_x : 1.2
    MDRectangleFlatButton :
        id : connect_return
        text : "Return"
        pos_hint : {"center_x" : 0.25 , "center_y" : 0.25}
        disabled : False
        on_release :
            root.top()
    MDRectangleFlatButton :
        id : recon_button
        text : "Proceed"
        pos_hint : {"center_x" : 0.75 , "center_y" : 0.25}
        disabled : False
        on_release :
            root.reconnect()

<MaintenanceWindow>


    name : "maintenance"
    MDLabel :
        id: maintenance_title
        font_size : '25sp'
        text : "メンテナンス画面"
        underline : True
        pos_hint : {"center_x" : 0.5 , "center_y" : 0.9}
        halign :"center"
        size_hint_x :1
    MDRectangleFlatButton :
        id : maintenance_button_start
        font_size : '14sp'
        size_hint :0.25 ,0.035
        text : "座面高さ校正開始➡"
        pos_hint : {"center_x" : 0.15 , "center_y" : 0.85}
        on_release:
            root.enable_test()

    MDLabel :
        font_size : '14sp'
        text : "1)手動で座面高さを10㎝に合わせる"
        pos_hint : {"center_x" : 0.215 , "center_y" : 0.80}
        size_hint_x :1.3
        halign :"center"
    MDLabel :
        id : test1
        font_size : '14sp'
        text : "現在の座面高さ＿＿㎝"
        pos_hint : {"center_x" : 0.315 , "center_y" : 0.75}
        size_hint_x :1
        halign :"center"

    MDRectangleFlatButton :
        id : maintenance_button_1
        font_size : '14sp'
        size_hint :0.20 ,0.035
        text : "測定開始"
        pos_hint : {"center_x" : 0.6 , "center_y" : 0.75}
        disabled : True
        on_release:
            root.test_1()


    MDLabel :
        font_size : '14sp'
        text : "2)手動で座面高さを40㎝に合わせる"
        pos_hint : {"center_x" : 0.215 , "center_y" : 0.60}
        size_hint_x :1
        halign :"center"
    MDLabel :
        id : test2
        font_size : '14sp'
        text : "現在の座面高さ＿＿㎝\n"
        pos_hint : {"center_x" : 0.315 , "center_y" : 0.55}
        size_hint_x :1
        halign :"center"

    MDRectangleFlatButton :
        id : maintenance_button_2
        font_size : '14sp'
        size_hint :0.20 ,0.035
        text : "測定開始"
        pos_hint : {"center_x" : 0.6 , "center_y" : 0.55}
        disabled : True
        on_release:
            root.test_2()

    MDLabel :
        font_size : '14sp'
        text : "座面高さ校正結果:"
        pos_hint : {"center_x" : 0.315 , "center_y" : 0.35}
        size_hint_x :1
        halign :"center"

    MDLabel :
        id : result
        font_size : '14sp'
        text : "A：＿＿\nB：＿＿"
        pos_hint : {"center_x" : 0.53 , "center_y" : 0.340}
        size_hint_x :1
        halign :"center"


    MDRectangleFlatButton :
        id : maintenance_end
        font_size : '14sp'
        size_hint :0.20 ,0.035
        text : "測定終了"
        pos_hint : {"center_x" : 0.5 , "center_y" : 0.2}
        disabled : True
        on_release:
            root.exit()
    MDTopAppBar:

        left_action_items: [['arrow-left', lambda x: root.back()]]

<ExplanationWindow>

    name : "explain"

    MDLabel :
        id:title_label
        text : "測定姿勢と立上がり動作の説明"
        font_size : '25sp'
        underline : True
        pos_hint : {"center_x" : 0.5 , "center_y" : 0.9}
        size_hint_x : 1
        halign :"center"


    MDLabel :
        text : "➡立上がり姿勢：\n        立上がりは右の絵のような姿勢で，背中を背もたれに当て\n    て，両手を胸の前に組み，両足または片足で行います．片足の\n    場合は右足と左足のどちらでも良いです．\n       踵は立ち上がりしやすいように，後ろに引いて置いてくださ\n    い．脛と地面の角度は約70°となります\n    "
        pos_hint : {"center_x" : 0.7, "center_y" :0.75}
        size_hint_x : 1.2
        halign :"left"
    MDLabel :
        text : "➡ 立上がり動作：\n       無理なく，ゆっくり立上がり，そのままを３秒程度維持して\n   ください．その後椅子に座り，結果を選んでください\n   "
        pos_hint : {"center_x" : 0.7, "center_y" :0.62}
        size_hint_x : 1.2
        halign :"left"
    MDLabel :
        text : "➡立上がり結果：\n        立ち上がりの結果はご自分で判断し，画面の「成功」または\n  「失敗」のボターンをクリックしてください． 「やり直し」を\n   クリックした場合，１回の直しはできます．"
        pos_hint : {"center_x" : 0.7, "center_y" :0.52}
        size_hint_x : 1.2
        halign :"left"
    MDLabel :
        text : "➡座面高さ調整：\n        座面高さは測定結果に応じて自動調整します．座ったままで\n   画面に指示に従ってください． "
        pos_hint : {"center_x" : 0.7, "center_y" :0.40}
        size_hint_x : 1.2
        halign :"left"
    MDTopAppBar:

        left_action_items: [['arrow-left', lambda x: root.back()]]




    MDRectangleFlatButton :
        text : "承知しました。測定開始"
        pos_hint : {"center_x" : 0.5 , "center_y" : 0.25}
        size_hint : 0.3,0.05

        on_release :
            app.root.current = "main"
            root.manager.transition.direction = "left"

    MDRectangleFlatButton :
        text : "戻る"
        pos_hint : {"" : 0.1 , "center_y" : 0.980}
        size_hint : 0.2,0.035
        on_release :
            app.root.current = "title"
            root.manager.transition.direction = "down"
    MDTopAppBar:

        left_action_items: [['arrow-left', lambda x: root.back()]]
